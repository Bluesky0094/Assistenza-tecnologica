const translations = {
  it: {
    site_title: "Assistenza Tecnologica",
    skip_link: "Vai al contenuto",
    hero_eyebrow: "Supporto tecnico e digitale",
    hero_title: "Risolvo problemi tecnologici, senza stress.",
    hero_subtitle:
      "Interventi rapidi in presenza a Modica e provincia di Ragusa, oppure da remoto ovunque.",
    hero_cta: "Scrivimi su WhatsApp",
    hero_cta_note: "Risposta veloce, zero impegno.",
    hero_panel_title: "Come posso aiutarti",
    hero_panel_item1: "Assistenza per casa e ufficio",
    hero_panel_item2: "Configurazioni sicure e pulite",
    hero_panel_item3: "Supporto remoto o in presenza",
    nav_home: "Home",
    nav_about: "Chi sono",
    nav_menu: "Menu",
    how_eyebrow: "Metodo in 3 passi",
    how_title: "Come funziona",
    how_subtitle: "Un percorso chiaro: contatto rapido, analisi e soluzione.",
    services_eyebrow: "Servizi",
    services_title: "Tutto l'aiuto, in un unico posto",
    services_subtitle:
      "Assistenza a domicilio e da remoto, per casa, ufficio e burocrazia digitale.",
    service_1_title: "Assistenza Tecnologica (Dispositivi & Backup)",
    service_1_body:
      "PC, smartphone, tablet, stampanti e rete domestica: configurazione, problemi, ottimizzazioni, migrazione dati e backup.",
    service_2_title: "Burocrazia Online & Pagamenti (SPID, INPS, PagoPA, Banking)",
    service_2_body:
      "Supporto guidato per SPID/CIE, portali della PA, pratiche online, app bancarie e pagamenti (PayPal/carte), accessi e configurazioni.",
    service_3_title: "Sicurezza Account & Recupero Accessi",
    service_3_body:
      "Password sicure, 2FA, password manager, recupero account, messa in sicurezza dopo accessi sospetti e prevenzione truffe.",
    service_4_title: "Privacy & Sicurezza Avanzata (uso lecito)",
    service_4_body:
      "Crittografia di file/backup, setup privacy su dispositivi e browser, riduzione tracciamento e configurazioni orientate alla protezione dei dati.",
    service_5_title: "Multimedia & Documenti",
    service_5_body:
      "PDF, scansioni, conversioni formati, impaginazione base e preparazione file per stampa/archiviazione.",
    service_6_title: "Video Editing",
    service_6_body:
      "Montaggio video (reels/shorts), tagli, sottotitoli, ottimizzazione export e contenuti per attivita locali.",
    service_7_title: "Siti Web Base",
    service_7_body:
      "Siti vetrina (one-page o poche pagine), contatti WhatsApp, mappa, dominio/hosting, aggiornamenti essenziali.",
    service_8_title: "Lezioni Personalizzate (Adulti & Anziani)",
    service_8_body:
      "Lezioni pratiche su computer/tablet/smartphone: WhatsApp, email, foto, file, app utili e sicurezza quotidiana.",
    how_step1_title: "1. Contatto rapido",
    how_step1_body:
      "Mi scrivi su WhatsApp: capisco la richiesta e ti dico tempi e costi.",
    how_step2_title: "2. Analisi e piano",
    how_step2_body: "Valuto il problema e ti propongo la soluzione piu adatta.",
    how_step3_title: "3. Soluzione e supporto",
    how_step3_body:
      "Intervento in presenza o remoto, con indicazioni per mantenere tutto sicuro.",
    toggle_to_en: "Passa a English",
    toggle_to_it: "Passa a Italiano",
    whatsapp_message: "Ciao! Ho visto il tuo sito e vorrei informazioni sui tuoi servizi.",
  },
  en: {
    site_title: "Assistenza Tecnologica",
    skip_link: "Skip to content",
    hero_eyebrow: "Technical and digital support",
    hero_title: "I solve tech problems, without the stress.",
    hero_subtitle:
      "Fast in-person help in Modica and the province of Ragusa, or remote anywhere.",
    hero_cta: "Message me on WhatsApp",
    hero_cta_note: "Quick reply, no commitment.",
    hero_panel_title: "How I can help",
    hero_panel_item1: "Help for home and small offices",
    hero_panel_item2: "Secure, clean configurations",
    hero_panel_item3: "Remote or in-person support",
    nav_home: "Home",
    nav_about: "About me",
    nav_menu: "Menu",
    how_eyebrow: "3-step process",
    how_title: "How it works",
    how_subtitle: "Clear flow: quick contact, analysis, and solution.",
    services_eyebrow: "Services",
    services_title: "All the help, in one place",
    services_subtitle:
      "On-site and remote help for home, office, and digital paperwork.",
    service_1_title: "Tech Support (Devices & Backups)",
    service_1_body:
      "PC, smartphone, tablet, printers, and home network: setup, troubleshooting, optimization, data migration, and backups.",
    service_2_title: "Online Services & Payments (SPID, Government Portals, Banking)",
    service_2_body:
      "Guided support for digital identity (SPID/CIE), government portals, online procedures, banking apps, and payments (PayPal/cards), access and setup.",
    service_3_title: "Account Security & Access Recovery",
    service_3_body:
      "Strong passwords, 2FA, password managers, account recovery, securing accounts after suspicious access, and scam prevention.",
    service_4_title: "Privacy & Advanced Security (legal use)",
    service_4_body:
      "File/backup encryption, privacy-focused device and browser setup, reduced tracking, and practical data-protection configurations.",
    service_5_title: "Multimedia & Documents",
    service_5_body:
      "PDF work, scanning, format conversion, basic layout, and print/archiving-ready files.",
    service_6_title: "Video Editing",
    service_6_body:
      "Editing for reels/shorts, cuts, subtitles, optimized exports, and content for local businesses.",
    service_7_title: "Basic Websites",
    service_7_body:
      "Simple showcase websites (one-page or a few pages), WhatsApp contact, map, domain/hosting setup, essential updates.",
    service_8_title: "1-to-1 Training (Adults & Seniors)",
    service_8_body:
      "Practical lessons for computer/tablet/smartphone: WhatsApp, email, photos, files, useful apps, and everyday digital safety.",
    how_step1_title: "1. Quick contact",
    how_step1_body:
      "Message me on WhatsApp so I can gauge the request and timing.",
    how_step2_title: "2. Analysis and plan",
    how_step2_body: "I review the issue and propose the best path forward.",
    how_step3_title: "3. Solution and support",
    how_step3_body:
      "On-site or remote help, with guidance to keep things secure.",
    toggle_to_en: "Switch to English",
    toggle_to_it: "Switch to Italian",
    whatsapp_message: "Hi! I saw your website and I'd like information about your services.",
  },
};

const baseWhatsApp = "https://wa.me/393514218212?text=";

const getWhatsAppLink = (lang) =>
  `${baseWhatsApp}${encodeURIComponent(translations[lang].whatsapp_message)}`;

const getStrings = (lang) => ({
  ...translations[lang],
  hero_whatsapp: getWhatsAppLink(lang),
});

const applyTranslations = (lang) => {
  const strings = getStrings(lang);
  if (!strings) return;

  document.documentElement.lang = lang;

  document.querySelectorAll("[data-i18n]").forEach((element) => {
    const key = element.dataset.i18n;
    if (strings[key]) {
      element.textContent = strings[key];
    }
  });

  document.querySelectorAll("[data-i18n-attr]").forEach((element) => {
    const pairs = element.dataset.i18nAttr.split(",");
    pairs.forEach((pair) => {
      const [attr, key] = pair.split(":").map((item) => item.trim());
      if (!attr || !key || !strings[key]) return;
      element.setAttribute(attr, strings[key]);
    });
  });

  const toggle = document.getElementById("lang-toggle");
  if (toggle) {
    const nextLang = lang === "it" ? "en" : "it";
    toggle.textContent = nextLang.toUpperCase();
    toggle.setAttribute(
      "aria-label",
      lang === "it" ? strings.toggle_to_en : strings.toggle_to_it
    );
  }

  localStorage.setItem("site_lang", lang);
};

const initLanguageToggle = () => {
  const saved = localStorage.getItem("site_lang");
  const initial = saved && translations[saved] ? saved : "it";
  applyTranslations(initial);

  const nav = document.getElementById("primary-nav");
  const menuToggle = document.getElementById("menu-toggle");

  if (menuToggle && nav) {
    menuToggle.addEventListener("click", () => {
      const isOpen = nav.classList.toggle("is-open");
      menuToggle.setAttribute("aria-expanded", isOpen ? "true" : "false");
    });

    nav.addEventListener("click", (event) => {
      const target = event.target;
      if (target && target.matches("a.nav-link")) {
        nav.classList.remove("is-open");
        menuToggle.setAttribute("aria-expanded", "false");
      }
    });
  }

  const toggle = document.getElementById("lang-toggle");
  if (!toggle) return;

  toggle.addEventListener("click", () => {
    const current = document.documentElement.lang || "it";
    const next = current === "it" ? "en" : "it";
    applyTranslations(next);
  });
};

initLanguageToggle();
